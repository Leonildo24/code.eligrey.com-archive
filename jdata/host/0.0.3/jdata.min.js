var u="undefined",f=false,t=true,h="trustedHosts",s=typeof localStorage!=u?localStorage:globalStorage[location.hostname],w="string";if(typeof postMessage!=u){if(typeof JSON==u){document.documentElement.appendChild(document.createElement("script")).src="json2.js"}if(!s.getItem(h)){s.setItem(h,"[]")}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(b){for(var a=0;a<this.length;a++){if(this[a]==b){return a}}return -1}}function m(l){var d=JSON.parse(l.data),a=d.id,k=JSON.parse(s.getItem(h).toString()),n=d.item,j=d.method,o=l.origin.replace(/^.+?:(\/\/)?/,"");if(typeof n==w){var b=n.toLowerCase()}function c(x,q){var p={};if(typeof a!=u){p.id=a}p.response=q&&typeof x!=u&&x!==null?x.toString():x;p.jdata=true;;l.source.postMessage(JSON.stringify(p),"*")}if(j=="get"&&typeof n==w){c(s.getItem(b)||null,t)}else{if((j=="set"||j=="remove")&&typeof n==w){var e=j=="set";if(n==h){c(f)}else{k.indexOf(l.origin)+1||(!e?!s.getItem(b):false)||confirm("Allow "+o+" to "+(e?"modify the value of":"remove")+" the publicly shared item, "+n+"?")&&n!=h?(e&&typeof d.value==w?s.setItem(b,d.value):s.removeItem(b),c(t)):c(f)}}else{if(j=="list"){var g=[];for(i=0;i<s.length;i++){g.push(s.key(i))}c(g)}else{if(j=="length"){c(s.length)}else{if(j=="trust"){k.indexOf(l.origin)+1?c(t):confirm("Add "+o+" to trusted hosts?\nA trusted host does not need your permission to modify publicly shared data.\nYou can manage trusted hosts at "+location.href.substr(0,location.href.length-20)+"/manage")?(k.push(l.origin),k=JSON.stringify(k),s.setItem(h,k),k=JSON.parse(k),c(t)):c(f)}else{if(j=="untrust"){if(k.indexOf(l.origin)+1){k.splice(k.indexOf(l.origin),1),k=JSON.stringify(k),s.setItem(h,k)}c(t)}}}}}}}function v(c,b,a){if(c.attachEvent){c.attachEvent("on"+b,a)}else{c.addEventListener(b,a,false)}}onload=function(){v(this,"message",m)}};
